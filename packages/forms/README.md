# Reactable Forms (WIP)

## Description

State Management of reactive forms with [Reactables](https://github.com/reactables/reactables/tree/main/packages/core).

## Table of Contents

1. [Installation](#installation)
1. [Examples](#examples)
    1. [Form Control](#form-control)
    1. [Form Array](#form-array)
    1. [Form Group](#form-group)

1. [API](#api)
    1. [RxActions](#api-actions)
    1. [build](#api-build)
    1. [control](#api-control)
    1. [group](#api-group)
    1. [array](#api-array)
    1. [Other Interfaces](#interfaces)


## Installation <a name="installation"></a>

Installation will require [RxJS](https://rxjs.dev/) if not already installed.

`npm i rxjs @reactables/forms`

## Examples <a name="examples"></a>

WIP

## API <a name="api"></a>

The API for building Reactable Forms is very similar to [Angular FormBuilder](https://angular.io/api/forms/FormBuilder). It has been adapted to support Reactable features.

### `RxActions` <a name="api-actions"></a>

Actions available to trigger state changes on Reactable.

```typescript
type RxFormActions = {
  updateValues: <T>(payload: ControlChange<T>) => void;
  addControl: (payload: AddControl) => void;
  pushControl: (payload: PushControl) => void;
  removeControl: (payload: ControlRef) => void;
  markControlAsPristine: (payload: ControlRef) => void;
  markControlAsTouched: (payload: MarkTouched) => void;
  markControlAsUntouched: (payload: ControlRef) => void;
  resetControl: (payload: ControlRef) => void;
};
```

### `build` <a name="api-build"></a>

```typescript
type build = (config: AbstractControlConfig, options?: RxFormOptions) => Reactable<Form<unknown>, RxFormActions>
```

Factory method for creating a form Reactable. Accepts a configuration object generated by one or more helper methods - [`control`](#api-control), [`group`](#api-group), [`array`](#api-array). Also accepts an `RxFormOptions` object.


```typescript
interface RxFormOptions {
  reducers?: { [key:string]: CustomReducer }
  effects?: Effect<unknown, unknown>[];
  sources?: Observable<Action<unknown>>[] | { [key: string]: Observable<unknown> };
}

type CustomReducer = (
  reducers: FormReducers,
  state: BaseFormState<unknown>,
  action: Action<unknown>,
) => BaseFormState<unknown>;

interface FormReducers {
  updateValues: <T>(state: BaseFormState<T>, action: Action<ControlChange<unknown>>) => BaseFormState<T>;
  removeControl: <T>(state: BaseFormState<T>, action: Action<ControlRef>) => BaseFormState<T>;
  pushControl: <T>(state: BaseFormState<T>, action: Action<PushControl>) => BaseFormState<T>;
  addControl: <T>(state: BaseFormState<T>, action: Action<AddControl>) => BaseFormState<T>;
  markControlAsPristine: <T>(state: BaseFormState<T>, action: Action<ControlRef>) => BaseFormState<T>;
  markControlAsTouched: <T>(state: BaseFormState<T>, action: Action<MarkTouched>) => BaseFormState<T>;
  markControlAsUntouched: <T>(state: BaseFormState<T>, action: Action<ControlRef>) => BaseFormState<T>;
  resetControl: <T>(state: BaseFormState<T>, action: Action<ControlRef>) => BaseFormState<T>;
}
```
| Property | Description |
| -------- | ----------- |
| reducers (optional) | Dictionary of `CustomReducer`s to implement custom form behaviour. The `CustomReducer` provides built in `FormReducers`. **Updates to the form state need to be made with `FormReducers` to maintain integrity of the form state tree**. |
| effects (optional) | Array of [Effects](https://github.com/reactables/reactables/tree/main/packages/core#api-effect) to be registered to the Reactable. |
| sources (optional) | Additional [Action](https://github.com/reactables/reactables/tree/main/packages/core#action-) Observables the Reactable is listening to. Can be an array or a dictionary where key is the action type and value is the Observable emitting the payload. |

### `control` <a name="api-control"></a>

Function to create a `FormControlConfig` configuration object. Accepts a configuration object or a tuple.
```typescript
type control = <T>(config: FormControlConfig<T> | FbControl<T>) => FormControlConfig<T>

interface FormControlConfig<T>  {
  initialValue: T;
  validators?: ValidatorFn[];
  asyncValidators?: ValidatorAsyncFn[];
}

type FbControl<T> = [T, (ValidatorFn | ValidatorFn[])?, (ValidatorAsyncFn | ValidatorAsyncFn[])?];
```

### `group` <a name="api-group"></a>

Function to create a `FormGroupConfig` configuration object. Accepts a configuration object containing a `controls` dictionary of additional configuration objects generated by [`control`](#api-control), [`group`](#api-group), or [`array`](#api-array).

```typescript
type group = (config: FormGroupConfig) => FormGroupConfig

interface FormGroupConfig{
  validators?: ValidatorFn[];
  asyncValidators?: ValidatorAsyncFn[];
  controls: { [key: string]: AbstractControlConfig };
}
```
### `array` <a name="api-array"></a>

Function to create a `FormArrayConfig` configuration object. Accepts a configuration object containing a `controls` array of additional configuration objects generated by [`control`](#api-control), [`group`](#api-group), or [`array`](#api-array).

```typescript
type array = (config: FormArrayConfig) => FormArrayConfig

interface FormArrayConfig {
  validators?: ValidatorFn[];
  asyncValidators?: ValidatorAsyncFn[];
  controls: AbstractControlConfig[];
}
```

### Other Interfaces <a name="interfaces"></a>